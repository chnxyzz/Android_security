# Vulnerability Analysis and Exploitation

- 攻击者怎样去做她想做的事情
- 攻击者如何绕过安全措施
- 所有攻击面

安全脆弱点

- 脆弱点：有一些负面的安全反响

威胁模型
“威胁模型”概述了攻击者可以做和不能做的事情
隐含的包括较弱的要求
隐含的排除更强的要求

例如，“攻击者可以安装以root身份运行恶意应用程序”
您可以假设攻击者可以获得所有权限
您可以假设攻击者无法在TEE中运行代码

在讨论攻击和防御系统时，牢记威胁模型至关重要
威胁模型T下可以攻击X.
不知道T，所有的攻击可能是微不足道/不可能

防御系统 Y 在 T 下有效
不知道T，所有的防御系统都是安全/脆弱

对于攻击者的威胁模型
“假设我将代码作为第三方应用程序执行，我可以编写任意文件”
她没能力这样做！ ⇒有趣的攻击！

“假设我有root访问权限，我可以编写任意文件”
当然你可以......⇒无用的攻击

用于判断“新”工具有用性的经验法则：
如果假设威胁模型T，你知道如何实现目标G（不使用新信息）⇒不感兴趣
示例：“假设是root攻击者，我可以读取'私有'app文件”

也有例外：如果新攻击显示出一种全新的技术，那么它仍然会很有趣！
例如：“我们已经知道的东西可能通过不同的bug X”
例如：“我们已经知道的东西'在概念上'可能'但实际上很棘手”

0权限
1）显示任意内容 2）向其他应用程序发送意图 3）尝试启动root exploits

1权限，攻击者知道受害者电话号码
比如诱使受害者访问任意URL
1）假设使用http流量的应用程序
2）诱使用户点击链接，然后url可以托管恶意网站

1权限，用户与攻击者在同一个网络下
通常的目标：嗅探/劫持HTTP流量
净效应有时与“访问恶意URL”场景重叠
只需等待不相关的HTTP连接⇒在那里注入你的有效载荷

Attacker can run code as a privileged user (root, system)

Attacker can run code in the kernel

Attacker can run code in a Trusted App (TEE userspace)

Attacker can run code as within the TEE OS

Attacker can run code within the baseband processor

Attacker has physical access to the device

Implications
she can "play" with the lock screen
she can plug a USB cable
she can initiate NFC transactions
she can attempt to tamper with the hardware
she can tamper with hardware security modules

远程攻击者
攻击者可以引诱受害者访问网页，阅读电子邮件，接收短信

近端攻击者
攻击者在受害者附近“身体上”
相同的WiFi网络，可以发送格式错误的WiFi /蓝牙数据包

本地攻击者
攻击者可以在受害者的设备上运行代码（通过安装的应用程序）
攻击者可以物理访问设备

攻击面
威胁模型决定攻击面

漏洞表征


根据受影响的设备硬件/软件组件，Vulns更重要/更不重要
即，“bug在哪里？”

取决于“在哪里”
Vuln可能允许特权代码执行
Vuln可能更容易到达

例子
OS媒体库，OS网络堆栈，Selinux强制执行，安全启动
系统应用程序/应用程序（与网络相关，与意图相关，与资源相关）

两方面关于bug的地方
  哪个组件是bug？
	该组件是否享有特权？
  这个组件的哪个部分是bug？
	输入处理？
	攻击者可以到达吗？
		如果是的话：好极了！
		如果不是：无论错误是什么，它都可能没用


跟踪每年发现的bug很重要
track them and convenient way to address them
考虑具体的细节，在讨论这些bug的细节时
描述在受影响组件的安全更新中修复了哪些漏洞

CVE，type，component affected,severity,relevant threat models,attack vectors。


# Classes of vulnerabilities
From high-level to low-level
	
## the user

## apps (third-party apps and system apps)
	
### apps
	
- What: sensitive resource/permission or leak sensitive information

- How : 如何与目标app交互 和 入口点 枚举 

### App <- -> Network backend

- app 如何与网络交互：http 还是 https、攻击者可以看到sent and received？MITM？接受的data怎么用的？盲目被app信任吗？

### 动态代码加载

- app 动态加载 code，通常从network加载
- 代码从http下载、可以即时更改有效负载、下载代码存储在SD卡上、可以修改文件、缺少完整性检查的话攻击者可以修改并在应用程序中执行、如果检查完整性，可能存在TOCTOU漏洞
TODO http://www.s3.eurecom.fr/~yanick/publications/2014_ndss_android-remote-code-execution.pdf

### 加密 漏洞
- 加密API本身通常都可以
- 漏洞通常在于1）如何（错误地）使用这些API，2）开发人员甚至不尝试使用它们（没有加密情况）

### 非安全存储
考虑应用程序A，它可以访问敏感信息，它包含使用敏感权限的功能
当App A没有正确保护其他应用程序的敏感方面时，会出现非安全存储

### 组件劫持
组件劫持（CH）攻击旨在通过其导出的组件获取对应用程序的受保护资源的未授权访问
TODO http://www.s3.eurecom.fr/~yanick/publications/2014_ndss_android-remote-code-execution.pdf

### 权限泄漏
TODO https://www.csc2.ncsu.edu/faculty/xjiang4/pubs/NDSS12_WOODPECKER.pdf
清除用户数据，发送短信，记录用户对话等功能

### Content 泄漏 & 污染
Content 是数据库的包装起
如果这些数据库允许“过多”访问外部应用程序怎么办？
泄漏：披露各种类型的私人应用内数据
污染：操纵安全敏感的应用内设置或配置
TODO https://www.csc2.ncsu.edu/faculty/xjiang4/pubs/NDSS13_CONTENTSCOPE.pdf
泄漏:SMS消息，联系人，私人IM信息，用户登录信用（漏洞应用程序存储FB令牌），浏览器历史记录和书签，呼叫日志

污染:阻止来自特定号码的短信/电话（黑名单）,在后台+弹出窗口下载应用程序以进行安装

### 过度许可
App 需要权限X，即使不需要使用这个权限

### Zip 路径穿越
zip文件可以包含相对的../../evil.sh文件路径解压缩后，它可以覆盖不同目录中的文件⇒文件通过缓存的DEX覆盖写入代码执行
TODO!!! https://www.nowsecure.com/blog/2015/06/16/remote-code-execution-as-system-user-on-samsung-phones/

### Native Code
C / C ++代码可能容易受到许多内存损坏漏洞的攻击缓冲区溢出，悬空指针，释放后使用，类型混乱等。这是SYSSEC的关键主题之一
如果攻击者的输入可以“到达”这些组件......⇒然后这些漏洞发挥作用

## system components / operating system

每个月都有bug，影响不同的组件。
Framework, media framework, system, kernel components, Qualcomm components

### 不安全的 自我更新
受PileUp漏洞影响的Android更新机制，应用程序需要尚不存在的权限，通过操作系统更新进行权限提升（2014年）

### some components usually lead to higher severity

- Example: Media framework
	- Stagefright bug 2015

### Baseband vulnerabilities

- https://www.youtube.com/watch?v=6bpxrfB9ioo
- 可以通过连接到恶意基站的电话触发导致基带处理器中的远程代码执行远程〜近端攻击者

### Bootloader 

Bootloader错误可能导致

- 执行任意代码（作为引导加载程序的一部分）
- 绕过安全启动⇒绕过信任链
- 永久拒绝服务

TODO https://translate.google.cn/#view=home&op=translate&sl=en&tl=zh-CN&text=Bootloader%20bugs%20can%20lead%0AExecute%20arbitrary%20code%20(as%20part%20of%20the%20bootloader)%0ABypass%20of%20secure%20boot%20⇒%20bypass%20of%20chain%20of%20trust%0APermanent%20denial-of-service
## user interface

## trusted apps and TEE OS

### TEE-related bugs

最终结果：用户空间应用程序可以通过TEE中的混淆代理读取任意内核空间内存
TODO https://machiry.github.io/files/boom.pdf

## hardware (RAM)

Bugs can also be in hardware components

rowhammer




